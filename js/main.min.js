"use strict";

document.addEventListener('DOMContentLoaded', function (event) {
  // OS Detection
  let osName = 'Unknown OS';
  if (navigator.appVersion.indexOf('Mac') != -1) osName = 'MacOS';

  if (osName === 'MacOS') {
    document.body.classList.add('macos');
  } // Slider People


  new Splide('#people_slider', {
    pagination: false,
    perMove: 1,
    perPage: 1,
    type: 'loop'
  }).mount(); // Slider Benefits

  new Splide('#benefits_slider', {
    gap: 30,
    pagination: false,
    perMove: 4,
    perPage: 5,
    type: 'slide',
    breakpoints: {
      1023: {
        perMove: 2,
        perPage: 2
      },
      600: {
        perMove: 1,
        perPage: 1,
        padding: {
          right: '65px'
        }
      }
    }
  }).mount(); // Slider Geography

  new Splide('#geography_slider', {
    pagination: true,
    perMove: 1,
    perPage: 1,
    type: 'loop',
    breakpoints: {
      1023: {
        pagination: false
      }
    }
  }).mount(); // Slider Partners

  new Splide('#partners_slider', {
    arrows: false,
    autoplay: true,
    drag: false,
    gap: 30,
    interval: 2000,
    pagination: false,
    pauseOnHover: false,
    pauseOnFocus: false,
    perMove: 1,
    perPage: 4,
    type: 'loop',
    breakpoints: {
      1023: {
        perPage: 3
      },
      600: {
        perPage: 2
      }
    }
  }).mount(); // Years Tabs

  function initTab(elem) {
    document.addEventListener('click', function (e) {
      if (!e.target.matches(elem + ' .t-btn')) return;else {
        if (!e.target.classList.contains('active')) {
          findActiveElementAndRemoveIt(elem + ' .t-btn');
          findActiveElementAndRemoveIt(elem + ' .t-panel');
          e.target.classList.add('active');
          setTimeout(function () {
            var panel = document.querySelectorAll(elem + ' .t-panel.' + e.target.dataset.name);
            Array.prototype.forEach.call(panel, function (el) {
              el.classList.add('active');
              const activePanelTab = document.querySelector('.t-panel.active .events__tab--clickable');
              activePanelTab.click();
            });
          }, 200);
        }
      }
    });
  }

  function findActiveElementAndRemoveIt(elem) {
    var elementList = document.querySelectorAll(elem);
    Array.prototype.forEach.call(elementList, function (e) {
      e.classList.remove('active');
    });
  }

  initTab('.years'); // Animations on Scroll

  const animItems = document.querySelectorAll('.animItem');

  if (animItems.length > 0) {
    window.addEventListener('scroll', animOnScroll);

    function animOnScroll(params) {
      for (let index = 0; index < animItems.length; index++) {
        const animItem = animItems[index];
        const animItemHeight = animItem.offsetHeight;
        const animItemOffset = offset(animItem).top; // const animStart = 4;

        const animStart = 2;
        let animItemPoint = window.innerHeight - animItemHeight / animStart;

        if (animItemHeight > window.innerHeight) {
          animItemPoint = window.innerHeight - window.innerHeight / animStart;
        }

        if (pageYOffset > animItemOffset - animItemPoint && pageYOffset < animItemOffset + animItemHeight) {
          animItem.classList.add('active');
        } else {
          if (!animItem.classList.contains('noRepeat')) {
            animItem.classList.remove('active');
          }
        }
      }
    }

    function offset(el) {
      const rect = el.getBoundingClientRect(),
            scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
            scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      return {
        top: rect.top + scrollTop,
        left: rect.left + scrollLeft
      };
    }

    setTimeout(() => {
      animOnScroll();
    }, 400);
  } // Popups Handling


  const popups = new HystModal({
    linkAttributeName: 'data-hystmodal'
  });
});